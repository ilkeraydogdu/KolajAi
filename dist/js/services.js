/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkkolajAI_frontend"] = self["webpackChunkkolajAI_frontend"] || []).push([[671],{

/***/ 889:
/***/ (function(module) {

eval("{/**\n * Frontend Services for KolajAI\n * Bu dosya frontend'de kullanılan service sınıflarını içerir\n */\n\n// Base API Service\nclass ApiService {\n  constructor(baseURL = '') {\n    this.baseURL = baseURL || window.location.origin;\n    this.defaultHeaders = {\n      'Content-Type': 'application/json',\n      'X-Requested-With': 'XMLHttpRequest'\n    };\n  }\n  async request(method, endpoint, data = null, options = {}) {\n    var _document$querySelect;\n    const url = `${this.baseURL}${endpoint}`;\n    const config = {\n      method: method.toUpperCase(),\n      headers: {\n        ...this.defaultHeaders,\n        ...options.headers\n      },\n      credentials: 'same-origin',\n      ...options\n    };\n\n    // Add CSRF token if available\n    const csrfToken = (_document$querySelect = document.querySelector('meta[name=\"csrf-token\"]')) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.getAttribute('content');\n    if (csrfToken) {\n      config.headers['X-CSRF-Token'] = csrfToken;\n    }\n\n    // Add auth token if available\n    const authToken = localStorage.getItem('auth_token');\n    if (authToken) {\n      config.headers['Authorization'] = `Bearer ${authToken}`;\n    }\n    if (data && ['POST', 'PUT', 'PATCH'].includes(config.method)) {\n      config.body = JSON.stringify(data);\n    }\n    try {\n      const response = await fetch(url, config);\n\n      // Handle different response types\n      const contentType = response.headers.get('content-type');\n      let responseData;\n      if (contentType && contentType.includes('application/json')) {\n        responseData = await response.json();\n      } else {\n        responseData = await response.text();\n      }\n      if (!response.ok) {\n        throw new Error(responseData.message || `HTTP ${response.status}: ${response.statusText}`);\n      }\n      return {\n        data: responseData,\n        status: response.status,\n        headers: response.headers\n      };\n    } catch (error) {\n      console.error('API Request failed:', error);\n      throw error;\n    }\n  }\n  async get(endpoint, options = {}) {\n    return this.request('GET', endpoint, null, options);\n  }\n  async post(endpoint, data, options = {}) {\n    return this.request('POST', endpoint, data, options);\n  }\n  async put(endpoint, data, options = {}) {\n    return this.request('PUT', endpoint, data, options);\n  }\n  async patch(endpoint, data, options = {}) {\n    return this.request('PATCH', endpoint, data, options);\n  }\n  async delete(endpoint, options = {}) {\n    return this.request('DELETE', endpoint, null, options);\n  }\n}\n\n// Authentication Service\nclass AuthService {\n  constructor() {\n    this.apiService = new ApiService();\n    this.currentUser = null;\n    this.isAuthenticated = false;\n  }\n  async init() {\n    // Check if user is already authenticated\n    const token = localStorage.getItem('auth_token');\n    if (token) {\n      try {\n        await this.getCurrentUser();\n      } catch (error) {\n        // Token might be expired, remove it\n        this.logout();\n      }\n    }\n  }\n  async login(email, password) {\n    try {\n      const response = await this.apiService.post('/api/auth/login', {\n        email,\n        password\n      });\n      if (response.data.token) {\n        localStorage.setItem('auth_token', response.data.token);\n        this.currentUser = response.data.user;\n        this.isAuthenticated = true;\n\n        // Trigger auth state change event\n        window.dispatchEvent(new CustomEvent('authStateChanged', {\n          detail: {\n            authenticated: true,\n            user: this.currentUser\n          }\n        }));\n      }\n      return response;\n    } catch (error) {\n      console.error('Login failed:', error);\n      throw error;\n    }\n  }\n  async register(userData) {\n    try {\n      const response = await this.apiService.post('/api/auth/register', userData);\n      return response;\n    } catch (error) {\n      console.error('Registration failed:', error);\n      throw error;\n    }\n  }\n  async getCurrentUser() {\n    try {\n      const response = await this.apiService.get('/api/auth/me');\n      this.currentUser = response.data;\n      this.isAuthenticated = true;\n      return response;\n    } catch (error) {\n      this.currentUser = null;\n      this.isAuthenticated = false;\n      throw error;\n    }\n  }\n  async logout() {\n    try {\n      await this.apiService.post('/api/auth/logout');\n    } catch (error) {\n      console.error('Logout request failed:', error);\n    } finally {\n      // Clear local state regardless of API call result\n      localStorage.removeItem('auth_token');\n      this.currentUser = null;\n      this.isAuthenticated = false;\n\n      // Trigger auth state change event\n      window.dispatchEvent(new CustomEvent('authStateChanged', {\n        detail: {\n          authenticated: false,\n          user: null\n        }\n      }));\n\n      // Redirect to login page\n      window.location.href = '/login';\n    }\n  }\n  async forgotPassword(email) {\n    try {\n      const response = await this.apiService.post('/api/auth/forgot-password', {\n        email\n      });\n      return response;\n    } catch (error) {\n      console.error('Forgot password failed:', error);\n      throw error;\n    }\n  }\n  async resetPassword(token, password, passwordConfirm) {\n    try {\n      const response = await this.apiService.post('/api/auth/reset-password', {\n        token,\n        password,\n        password_confirm: passwordConfirm\n      });\n      return response;\n    } catch (error) {\n      console.error('Reset password failed:', error);\n      throw error;\n    }\n  }\n  async updateProfile(userData) {\n    try {\n      const response = await this.apiService.put('/api/auth/profile', userData);\n      this.currentUser = response.data;\n      return response;\n    } catch (error) {\n      console.error('Profile update failed:', error);\n      throw error;\n    }\n  }\n  async changePassword(currentPassword, newPassword) {\n    try {\n      const response = await this.apiService.post('/api/auth/change-password', {\n        current_password: currentPassword,\n        new_password: newPassword\n      });\n      return response;\n    } catch (error) {\n      console.error('Password change failed:', error);\n      throw error;\n    }\n  }\n  getUser() {\n    return this.currentUser;\n  }\n  isLoggedIn() {\n    return this.isAuthenticated;\n  }\n}\n\n// Cart Service\nclass CartService {\n  constructor() {\n    this.apiService = new ApiService();\n    this.cart = {\n      items: [],\n      total: 0,\n      count: 0,\n      subtotal: 0,\n      tax: 0,\n      shipping: 0\n    };\n    this.storageKey = 'kolajAI_cart';\n  }\n  async init() {\n    var _window$app;\n    // Load cart from localStorage first (for offline support)\n    this.loadFromStorage();\n\n    // Then sync with server if user is authenticated\n    if ((_window$app = window.app) !== null && _window$app !== void 0 && (_window$app = _window$app.authService) !== null && _window$app !== void 0 && _window$app.isLoggedIn()) {\n      try {\n        await this.syncWithServer();\n      } catch (error) {\n        console.warn('Cart sync failed:', error);\n      }\n    }\n  }\n  async getCart() {\n    try {\n      const response = await this.apiService.get('/api/cart');\n      this.updateCart(response.data);\n      return this.cart;\n    } catch (error) {\n      console.error('Get cart failed:', error);\n      return this.cart;\n    }\n  }\n  async addItem(productId, quantity = 1, options = {}) {\n    try {\n      const response = await this.apiService.post('/api/cart/add', {\n        product_id: productId,\n        quantity,\n        ...options\n      });\n      this.updateCart(response.data);\n      this.saveToStorage();\n      this.triggerCartUpdate();\n      return response;\n    } catch (error) {\n      console.error('Add to cart failed:', error);\n      // Fallback to local storage for offline support\n      this.addItemLocally(productId, quantity, options);\n      throw error;\n    }\n  }\n  async updateItem(itemId, quantity) {\n    try {\n      const response = await this.apiService.put(`/api/cart/item/${itemId}`, {\n        quantity\n      });\n      this.updateCart(response.data);\n      this.saveToStorage();\n      this.triggerCartUpdate();\n      return response;\n    } catch (error) {\n      console.error('Update cart item failed:', error);\n      throw error;\n    }\n  }\n  async removeItem(itemId) {\n    try {\n      const response = await this.apiService.delete(`/api/cart/item/${itemId}`);\n      this.updateCart(response.data);\n      this.saveToStorage();\n      this.triggerCartUpdate();\n      return response;\n    } catch (error) {\n      console.error('Remove cart item failed:', error);\n      throw error;\n    }\n  }\n  async clearCart() {\n    try {\n      const response = await this.apiService.delete('/api/cart');\n      this.cart = {\n        items: [],\n        total: 0,\n        count: 0,\n        subtotal: 0,\n        tax: 0,\n        shipping: 0\n      };\n      this.saveToStorage();\n      this.triggerCartUpdate();\n      return response;\n    } catch (error) {\n      console.error('Clear cart failed:', error);\n      throw error;\n    }\n  }\n  async applyCoupon(couponCode) {\n    try {\n      const response = await this.apiService.post('/api/cart/coupon', {\n        coupon_code: couponCode\n      });\n      this.updateCart(response.data);\n      this.saveToStorage();\n      this.triggerCartUpdate();\n      return response;\n    } catch (error) {\n      console.error('Apply coupon failed:', error);\n      throw error;\n    }\n  }\n  async removeCoupon() {\n    try {\n      const response = await this.apiService.delete('/api/cart/coupon');\n      this.updateCart(response.data);\n      this.saveToStorage();\n      this.triggerCartUpdate();\n      return response;\n    } catch (error) {\n      console.error('Remove coupon failed:', error);\n      throw error;\n    }\n  }\n  addItemLocally(productId, quantity, options) {\n    // Find existing item\n    const existingItem = this.cart.items.find(item => item.product_id === productId);\n    if (existingItem) {\n      existingItem.quantity += quantity;\n    } else {\n      this.cart.items.push({\n        id: Date.now(),\n        // Temporary ID\n        product_id: productId,\n        quantity,\n        ...options\n      });\n    }\n    this.calculateTotals();\n    this.saveToStorage();\n    this.triggerCartUpdate();\n  }\n  updateCart(cartData) {\n    this.cart = {\n      ...this.cart,\n      ...cartData\n    };\n    this.calculateTotals();\n  }\n  calculateTotals() {\n    this.cart.count = this.cart.items.reduce((sum, item) => sum + item.quantity, 0);\n    this.cart.subtotal = this.cart.items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n    this.cart.total = this.cart.subtotal + this.cart.tax + this.cart.shipping;\n  }\n  saveToStorage() {\n    try {\n      localStorage.setItem(this.storageKey, JSON.stringify(this.cart));\n    } catch (error) {\n      console.error('Failed to save cart to storage:', error);\n    }\n  }\n  loadFromStorage() {\n    try {\n      const stored = localStorage.getItem(this.storageKey);\n      if (stored) {\n        this.cart = {\n          ...this.cart,\n          ...JSON.parse(stored)\n        };\n      }\n    } catch (error) {\n      console.error('Failed to load cart from storage:', error);\n    }\n  }\n  async syncWithServer() {\n    // Sync local cart with server\n    if (this.cart.items.length > 0) {\n      for (const item of this.cart.items) {\n        if (!item.synced) {\n          try {\n            await this.addItem(item.product_id, item.quantity, item.options);\n            item.synced = true;\n          } catch (error) {\n            console.warn('Failed to sync cart item:', error);\n          }\n        }\n      }\n    }\n\n    // Get latest cart from server\n    await this.getCart();\n  }\n  async savePendingData() {\n    // Save any pending changes before page unload\n    this.saveToStorage();\n  }\n  async syncOfflineData() {\n    // Sync offline changes when connection is restored\n    await this.syncWithServer();\n  }\n  triggerCartUpdate() {\n    // Trigger cart update event\n    window.dispatchEvent(new CustomEvent('cartUpdated', {\n      detail: this.cart\n    }));\n  }\n  getItemCount() {\n    return this.cart.count;\n  }\n  getTotal() {\n    return this.cart.total;\n  }\n  getItems() {\n    return this.cart.items;\n  }\n}\n\n// Notification Service\nclass NotificationService {\n  constructor() {\n    this.apiService = new ApiService();\n    this.notifications = [];\n    this.unreadCount = 0;\n    this.pollInterval = null;\n    this.pollFrequency = 30000; // 30 seconds\n  }\n  async init() {\n    var _window$app2;\n    // Load initial notifications\n    await this.getNotifications();\n\n    // Start polling for new notifications if user is authenticated\n    if ((_window$app2 = window.app) !== null && _window$app2 !== void 0 && (_window$app2 = _window$app2.authService) !== null && _window$app2 !== void 0 && _window$app2.isLoggedIn()) {\n      this.startPolling();\n    }\n\n    // Listen for auth state changes\n    window.addEventListener('authStateChanged', event => {\n      if (event.detail.authenticated) {\n        this.startPolling();\n      } else {\n        this.stopPolling();\n        this.notifications = [];\n        this.unreadCount = 0;\n      }\n    });\n  }\n  async getNotifications(page = 1, limit = 20) {\n    try {\n      const response = await this.apiService.get(`/api/notifications?page=${page}&limit=${limit}`);\n      if (page === 1) {\n        this.notifications = response.data.notifications || [];\n      } else {\n        this.notifications = [...this.notifications, ...(response.data.notifications || [])];\n      }\n      this.unreadCount = response.data.unread_count || 0;\n      this.triggerNotificationUpdate();\n      return response;\n    } catch (error) {\n      console.error('Get notifications failed:', error);\n      return {\n        data: {\n          notifications: [],\n          unread_count: 0\n        }\n      };\n    }\n  }\n  async markAsRead(notificationId) {\n    try {\n      const response = await this.apiService.post(`/api/notifications/${notificationId}/read`);\n\n      // Update local notification\n      const notification = this.notifications.find(n => n.id === notificationId);\n      if (notification) {\n        notification.read_at = new Date().toISOString();\n        this.unreadCount = Math.max(0, this.unreadCount - 1);\n        this.triggerNotificationUpdate();\n      }\n      return response;\n    } catch (error) {\n      console.error('Mark notification as read failed:', error);\n      throw error;\n    }\n  }\n  async markAllAsRead() {\n    try {\n      const response = await this.apiService.post('/api/notifications/read-all');\n\n      // Update local notifications\n      this.notifications.forEach(notification => {\n        if (!notification.read_at) {\n          notification.read_at = new Date().toISOString();\n        }\n      });\n      this.unreadCount = 0;\n      this.triggerNotificationUpdate();\n      return response;\n    } catch (error) {\n      console.error('Mark all notifications as read failed:', error);\n      throw error;\n    }\n  }\n  async deleteNotification(notificationId) {\n    try {\n      const response = await this.apiService.delete(`/api/notifications/${notificationId}`);\n\n      // Remove from local notifications\n      const index = this.notifications.findIndex(n => n.id === notificationId);\n      if (index !== -1) {\n        const notification = this.notifications[index];\n        if (!notification.read_at) {\n          this.unreadCount = Math.max(0, this.unreadCount - 1);\n        }\n        this.notifications.splice(index, 1);\n        this.triggerNotificationUpdate();\n      }\n      return response;\n    } catch (error) {\n      console.error('Delete notification failed:', error);\n      throw error;\n    }\n  }\n  async sendNotification(userId, title, message, type = 'info', data = {}) {\n    try {\n      const response = await this.apiService.post('/api/notifications/send', {\n        user_id: userId,\n        title,\n        message,\n        type,\n        data\n      });\n      return response;\n    } catch (error) {\n      console.error('Send notification failed:', error);\n      throw error;\n    }\n  }\n  startPolling() {\n    if (this.pollInterval) {\n      clearInterval(this.pollInterval);\n    }\n    this.pollInterval = setInterval(async () => {\n      try {\n        await this.getNotifications();\n      } catch (error) {\n        console.warn('Notification polling failed:', error);\n      }\n    }, this.pollFrequency);\n  }\n  stopPolling() {\n    if (this.pollInterval) {\n      clearInterval(this.pollInterval);\n      this.pollInterval = null;\n    }\n  }\n  async syncOfflineData() {\n    // Sync any offline notification actions when connection is restored\n    await this.getNotifications();\n  }\n  triggerNotificationUpdate() {\n    // Trigger notification update event\n    window.dispatchEvent(new CustomEvent('notificationsUpdated', {\n      detail: {\n        notifications: this.notifications,\n        unreadCount: this.unreadCount\n      }\n    }));\n  }\n  getNotifications() {\n    return this.notifications;\n  }\n  getUnreadCount() {\n    return this.unreadCount;\n  }\n\n  // Browser notification support\n  async requestPermission() {\n    if ('Notification' in window) {\n      const permission = await Notification.requestPermission();\n      return permission === 'granted';\n    }\n    return false;\n  }\n  showBrowserNotification(title, options = {}) {\n    if ('Notification' in window && Notification.permission === 'granted') {\n      const notification = new Notification(title, {\n        icon: '/static/assets/images/icon-192x192.png',\n        badge: '/static/assets/images/icon-72x72.png',\n        ...options\n      });\n\n      // Auto close after 5 seconds\n      setTimeout(() => notification.close(), 5000);\n      return notification;\n    }\n  }\n}\n\n// Initialize services when DOM is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n  // Make services globally available\n  window.app = window.app || {};\n  window.app.apiService = new ApiService();\n  window.app.authService = new AuthService();\n  window.app.cartService = new CartService();\n  window.app.notificationService = new NotificationService();\n});\n\n// Export for module systems\nif ( true && module.exports) {\n  module.exports = {\n    ApiService,\n    AuthService,\n    CartService,\n    NotificationService\n  };\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODg5LmpzIiwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2tvbGFqQUktZnJvbnRlbmQvLi93ZWIvc3RhdGljL2pzL3NlcnZpY2VzLmpzP2UzMTYiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBGcm9udGVuZCBTZXJ2aWNlcyBmb3IgS29sYWpBSVxuICogQnUgZG9zeWEgZnJvbnRlbmQnZGUga3VsbGFuxLFsYW4gc2VydmljZSBzxLFuxLFmbGFyxLFuxLEgacOnZXJpclxuICovXG5cbi8vIEJhc2UgQVBJIFNlcnZpY2VcbmNsYXNzIEFwaVNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihiYXNlVVJMID0gJycpIHtcbiAgICB0aGlzLmJhc2VVUkwgPSBiYXNlVVJMIHx8IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW47XG4gICAgdGhpcy5kZWZhdWx0SGVhZGVycyA9IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAnWC1SZXF1ZXN0ZWQtV2l0aCc6ICdYTUxIdHRwUmVxdWVzdCdcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgcmVxdWVzdChtZXRob2QsIGVuZHBvaW50LCBkYXRhID0gbnVsbCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVVJMfSR7ZW5kcG9pbnR9YDtcbiAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICBtZXRob2Q6IG1ldGhvZC50b1VwcGVyQ2FzZSgpLFxuICAgICAgaGVhZGVyczogeyAuLi50aGlzLmRlZmF1bHRIZWFkZXJzLCAuLi5vcHRpb25zLmhlYWRlcnMgfSxcbiAgICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLFxuICAgICAgLi4ub3B0aW9uc1xuICAgIH07XG5cbiAgICAvLyBBZGQgQ1NSRiB0b2tlbiBpZiBhdmFpbGFibGVcbiAgICBjb25zdCBjc3JmVG9rZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJyk/LmdldEF0dHJpYnV0ZSgnY29udGVudCcpO1xuICAgIGlmIChjc3JmVG9rZW4pIHtcbiAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUNTUkYtVG9rZW4nXSA9IGNzcmZUb2tlbjtcbiAgICB9XG5cbiAgICAvLyBBZGQgYXV0aCB0b2tlbiBpZiBhdmFpbGFibGVcbiAgICBjb25zdCBhdXRoVG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYXV0aF90b2tlbicpO1xuICAgIGlmIChhdXRoVG9rZW4pIHtcbiAgICAgIGNvbmZpZy5oZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7YXV0aFRva2VufWA7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEgJiYgWydQT1NUJywgJ1BVVCcsICdQQVRDSCddLmluY2x1ZGVzKGNvbmZpZy5tZXRob2QpKSB7XG4gICAgICBjb25maWcuYm9keSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgY29uZmlnKTtcbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGRpZmZlcmVudCByZXNwb25zZSB0eXBlc1xuICAgICAgY29uc3QgY29udGVudFR5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJyk7XG4gICAgICBsZXQgcmVzcG9uc2VEYXRhO1xuICAgICAgXG4gICAgICBpZiAoY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkge1xuICAgICAgICByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlRGF0YS5tZXNzYWdlIHx8IGBIVFRQICR7cmVzcG9uc2Uuc3RhdHVzfTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBkYXRhOiByZXNwb25zZURhdGEsXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICBoZWFkZXJzOiByZXNwb25zZS5oZWFkZXJzXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdBUEkgUmVxdWVzdCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0KGVuZHBvaW50LCBvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdHRVQnLCBlbmRwb2ludCwgbnVsbCwgb3B0aW9ucyk7XG4gIH1cblxuICBhc3luYyBwb3N0KGVuZHBvaW50LCBkYXRhLCBvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdQT1NUJywgZW5kcG9pbnQsIGRhdGEsIG9wdGlvbnMpO1xuICB9XG5cbiAgYXN5bmMgcHV0KGVuZHBvaW50LCBkYXRhLCBvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdQVVQnLCBlbmRwb2ludCwgZGF0YSwgb3B0aW9ucyk7XG4gIH1cblxuICBhc3luYyBwYXRjaChlbmRwb2ludCwgZGF0YSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnUEFUQ0gnLCBlbmRwb2ludCwgZGF0YSwgb3B0aW9ucyk7XG4gIH1cblxuICBhc3luYyBkZWxldGUoZW5kcG9pbnQsIG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ0RFTEVURScsIGVuZHBvaW50LCBudWxsLCBvcHRpb25zKTtcbiAgfVxufVxuXG4vLyBBdXRoZW50aWNhdGlvbiBTZXJ2aWNlXG5jbGFzcyBBdXRoU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYXBpU2VydmljZSA9IG5ldyBBcGlTZXJ2aWNlKCk7XG4gICAgdGhpcy5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGFzeW5jIGluaXQoKSB7XG4gICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhbHJlYWR5IGF1dGhlbnRpY2F0ZWRcbiAgICBjb25zdCB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhdXRoX3Rva2VuJyk7XG4gICAgaWYgKHRva2VuKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBUb2tlbiBtaWdodCBiZSBleHBpcmVkLCByZW1vdmUgaXRcbiAgICAgICAgdGhpcy5sb2dvdXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2dpbihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UucG9zdCgnL2FwaS9hdXRoL2xvZ2luJywge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmRcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzcG9uc2UuZGF0YS50b2tlbikge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYXV0aF90b2tlbicsIHJlc3BvbnNlLmRhdGEudG9rZW4pO1xuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gcmVzcG9uc2UuZGF0YS51c2VyO1xuICAgICAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWU7XG4gICAgICAgIFxuICAgICAgICAvLyBUcmlnZ2VyIGF1dGggc3RhdGUgY2hhbmdlIGV2ZW50XG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnYXV0aFN0YXRlQ2hhbmdlZCcsIHsgXG4gICAgICAgICAgZGV0YWlsOiB7IGF1dGhlbnRpY2F0ZWQ6IHRydWUsIHVzZXI6IHRoaXMuY3VycmVudFVzZXIgfSBcbiAgICAgICAgfSkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0xvZ2luIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyByZWdpc3Rlcih1c2VyRGF0YSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuYXBpU2VydmljZS5wb3N0KCcvYXBpL2F1dGgvcmVnaXN0ZXInLCB1c2VyRGF0YSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZ2lzdHJhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0Q3VycmVudFVzZXIoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLmdldCgnL2FwaS9hdXRoL21lJyk7XG4gICAgICB0aGlzLmN1cnJlbnRVc2VyID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9nb3V0KCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmFwaVNlcnZpY2UucG9zdCgnL2FwaS9hdXRoL2xvZ291dCcpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdMb2dvdXQgcmVxdWVzdCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAvLyBDbGVhciBsb2NhbCBzdGF0ZSByZWdhcmRsZXNzIG9mIEFQSSBjYWxsIHJlc3VsdFxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2F1dGhfdG9rZW4nKTtcbiAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBudWxsO1xuICAgICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcbiAgICAgIFxuICAgICAgLy8gVHJpZ2dlciBhdXRoIHN0YXRlIGNoYW5nZSBldmVudFxuICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdhdXRoU3RhdGVDaGFuZ2VkJywgeyBcbiAgICAgICAgZGV0YWlsOiB7IGF1dGhlbnRpY2F0ZWQ6IGZhbHNlLCB1c2VyOiBudWxsIH0gXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIC8vIFJlZGlyZWN0IHRvIGxvZ2luIHBhZ2VcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9sb2dpbic7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZm9yZ290UGFzc3dvcmQoZW1haWwpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UucG9zdCgnL2FwaS9hdXRoL2ZvcmdvdC1wYXNzd29yZCcsIHsgZW1haWwgfSk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZvcmdvdCBwYXNzd29yZCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVzZXRQYXNzd29yZCh0b2tlbiwgcGFzc3dvcmQsIHBhc3N3b3JkQ29uZmlybSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuYXBpU2VydmljZS5wb3N0KCcvYXBpL2F1dGgvcmVzZXQtcGFzc3dvcmQnLCB7XG4gICAgICAgIHRva2VuLFxuICAgICAgICBwYXNzd29yZCxcbiAgICAgICAgcGFzc3dvcmRfY29uZmlybTogcGFzc3dvcmRDb25maXJtXG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignUmVzZXQgcGFzc3dvcmQgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZVByb2ZpbGUodXNlckRhdGEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UucHV0KCcvYXBpL2F1dGgvcHJvZmlsZScsIHVzZXJEYXRhKTtcbiAgICAgIHRoaXMuY3VycmVudFVzZXIgPSByZXNwb25zZS5kYXRhO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdQcm9maWxlIHVwZGF0ZSBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2hhbmdlUGFzc3dvcmQoY3VycmVudFBhc3N3b3JkLCBuZXdQYXNzd29yZCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuYXBpU2VydmljZS5wb3N0KCcvYXBpL2F1dGgvY2hhbmdlLXBhc3N3b3JkJywge1xuICAgICAgICBjdXJyZW50X3Bhc3N3b3JkOiBjdXJyZW50UGFzc3dvcmQsXG4gICAgICAgIG5ld19wYXNzd29yZDogbmV3UGFzc3dvcmRcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdQYXNzd29yZCBjaGFuZ2UgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGdldFVzZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFVzZXI7XG4gIH1cblxuICBpc0xvZ2dlZEluKCkge1xuICAgIHJldHVybiB0aGlzLmlzQXV0aGVudGljYXRlZDtcbiAgfVxufVxuXG4vLyBDYXJ0IFNlcnZpY2VcbmNsYXNzIENhcnRTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5hcGlTZXJ2aWNlID0gbmV3IEFwaVNlcnZpY2UoKTtcbiAgICB0aGlzLmNhcnQgPSB7XG4gICAgICBpdGVtczogW10sXG4gICAgICB0b3RhbDogMCxcbiAgICAgIGNvdW50OiAwLFxuICAgICAgc3VidG90YWw6IDAsXG4gICAgICB0YXg6IDAsXG4gICAgICBzaGlwcGluZzogMFxuICAgIH07XG4gICAgdGhpcy5zdG9yYWdlS2V5ID0gJ2tvbGFqQUlfY2FydCc7XG4gIH1cblxuICBhc3luYyBpbml0KCkge1xuICAgIC8vIExvYWQgY2FydCBmcm9tIGxvY2FsU3RvcmFnZSBmaXJzdCAoZm9yIG9mZmxpbmUgc3VwcG9ydClcbiAgICB0aGlzLmxvYWRGcm9tU3RvcmFnZSgpO1xuICAgIFxuICAgIC8vIFRoZW4gc3luYyB3aXRoIHNlcnZlciBpZiB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcbiAgICBpZiAod2luZG93LmFwcD8uYXV0aFNlcnZpY2U/LmlzTG9nZ2VkSW4oKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5zeW5jV2l0aFNlcnZlcigpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdDYXJ0IHN5bmMgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRDYXJ0KCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuYXBpU2VydmljZS5nZXQoJy9hcGkvY2FydCcpO1xuICAgICAgdGhpcy51cGRhdGVDYXJ0KHJlc3BvbnNlLmRhdGEpO1xuICAgICAgcmV0dXJuIHRoaXMuY2FydDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignR2V0IGNhcnQgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB0aGlzLmNhcnQ7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYWRkSXRlbShwcm9kdWN0SWQsIHF1YW50aXR5ID0gMSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLnBvc3QoJy9hcGkvY2FydC9hZGQnLCB7XG4gICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgcXVhbnRpdHksXG4gICAgICAgIC4uLm9wdGlvbnNcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnVwZGF0ZUNhcnQocmVzcG9uc2UuZGF0YSk7XG4gICAgICB0aGlzLnNhdmVUb1N0b3JhZ2UoKTtcbiAgICAgIHRoaXMudHJpZ2dlckNhcnRVcGRhdGUoKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdBZGQgdG8gY2FydCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gbG9jYWwgc3RvcmFnZSBmb3Igb2ZmbGluZSBzdXBwb3J0XG4gICAgICB0aGlzLmFkZEl0ZW1Mb2NhbGx5KHByb2R1Y3RJZCwgcXVhbnRpdHksIG9wdGlvbnMpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlSXRlbShpdGVtSWQsIHF1YW50aXR5KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLnB1dChgL2FwaS9jYXJ0L2l0ZW0vJHtpdGVtSWR9YCwge1xuICAgICAgICBxdWFudGl0eVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudXBkYXRlQ2FydChyZXNwb25zZS5kYXRhKTtcbiAgICAgIHRoaXMuc2F2ZVRvU3RvcmFnZSgpO1xuICAgICAgdGhpcy50cmlnZ2VyQ2FydFVwZGF0ZSgpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1VwZGF0ZSBjYXJ0IGl0ZW0gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlbW92ZUl0ZW0oaXRlbUlkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLmRlbGV0ZShgL2FwaS9jYXJ0L2l0ZW0vJHtpdGVtSWR9YCk7XG4gICAgICBcbiAgICAgIHRoaXMudXBkYXRlQ2FydChyZXNwb25zZS5kYXRhKTtcbiAgICAgIHRoaXMuc2F2ZVRvU3RvcmFnZSgpO1xuICAgICAgdGhpcy50cmlnZ2VyQ2FydFVwZGF0ZSgpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlbW92ZSBjYXJ0IGl0ZW0gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNsZWFyQ2FydCgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UuZGVsZXRlKCcvYXBpL2NhcnQnKTtcbiAgICAgIFxuICAgICAgdGhpcy5jYXJ0ID0ge1xuICAgICAgICBpdGVtczogW10sXG4gICAgICAgIHRvdGFsOiAwLFxuICAgICAgICBjb3VudDogMCxcbiAgICAgICAgc3VidG90YWw6IDAsXG4gICAgICAgIHRheDogMCxcbiAgICAgICAgc2hpcHBpbmc6IDBcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHRoaXMuc2F2ZVRvU3RvcmFnZSgpO1xuICAgICAgdGhpcy50cmlnZ2VyQ2FydFVwZGF0ZSgpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NsZWFyIGNhcnQgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFwcGx5Q291cG9uKGNvdXBvbkNvZGUpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UucG9zdCgnL2FwaS9jYXJ0L2NvdXBvbicsIHtcbiAgICAgICAgY291cG9uX2NvZGU6IGNvdXBvbkNvZGVcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnVwZGF0ZUNhcnQocmVzcG9uc2UuZGF0YSk7XG4gICAgICB0aGlzLnNhdmVUb1N0b3JhZ2UoKTtcbiAgICAgIHRoaXMudHJpZ2dlckNhcnRVcGRhdGUoKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdBcHBseSBjb3Vwb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlbW92ZUNvdXBvbigpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UuZGVsZXRlKCcvYXBpL2NhcnQvY291cG9uJyk7XG4gICAgICBcbiAgICAgIHRoaXMudXBkYXRlQ2FydChyZXNwb25zZS5kYXRhKTtcbiAgICAgIHRoaXMuc2F2ZVRvU3RvcmFnZSgpO1xuICAgICAgdGhpcy50cmlnZ2VyQ2FydFVwZGF0ZSgpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlbW92ZSBjb3Vwb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFkZEl0ZW1Mb2NhbGx5KHByb2R1Y3RJZCwgcXVhbnRpdHksIG9wdGlvbnMpIHtcbiAgICAvLyBGaW5kIGV4aXN0aW5nIGl0ZW1cbiAgICBjb25zdCBleGlzdGluZ0l0ZW0gPSB0aGlzLmNhcnQuaXRlbXMuZmluZChpdGVtID0+IGl0ZW0ucHJvZHVjdF9pZCA9PT0gcHJvZHVjdElkKTtcbiAgICBcbiAgICBpZiAoZXhpc3RpbmdJdGVtKSB7XG4gICAgICBleGlzdGluZ0l0ZW0ucXVhbnRpdHkgKz0gcXVhbnRpdHk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2FydC5pdGVtcy5wdXNoKHtcbiAgICAgICAgaWQ6IERhdGUubm93KCksIC8vIFRlbXBvcmFyeSBJRFxuICAgICAgICBwcm9kdWN0X2lkOiBwcm9kdWN0SWQsXG4gICAgICAgIHF1YW50aXR5LFxuICAgICAgICAuLi5vcHRpb25zXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5jYWxjdWxhdGVUb3RhbHMoKTtcbiAgICB0aGlzLnNhdmVUb1N0b3JhZ2UoKTtcbiAgICB0aGlzLnRyaWdnZXJDYXJ0VXBkYXRlKCk7XG4gIH1cblxuICB1cGRhdGVDYXJ0KGNhcnREYXRhKSB7XG4gICAgdGhpcy5jYXJ0ID0ge1xuICAgICAgLi4udGhpcy5jYXJ0LFxuICAgICAgLi4uY2FydERhdGFcbiAgICB9O1xuICAgIHRoaXMuY2FsY3VsYXRlVG90YWxzKCk7XG4gIH1cblxuICBjYWxjdWxhdGVUb3RhbHMoKSB7XG4gICAgdGhpcy5jYXJ0LmNvdW50ID0gdGhpcy5jYXJ0Lml0ZW1zLnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyBpdGVtLnF1YW50aXR5LCAwKTtcbiAgICB0aGlzLmNhcnQuc3VidG90YWwgPSB0aGlzLmNhcnQuaXRlbXMucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIChpdGVtLnByaWNlICogaXRlbS5xdWFudGl0eSksIDApO1xuICAgIHRoaXMuY2FydC50b3RhbCA9IHRoaXMuY2FydC5zdWJ0b3RhbCArIHRoaXMuY2FydC50YXggKyB0aGlzLmNhcnQuc2hpcHBpbmc7XG4gIH1cblxuICBzYXZlVG9TdG9yYWdlKCkge1xuICAgIHRyeSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLnN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KHRoaXMuY2FydCkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBjYXJ0IHRvIHN0b3JhZ2U6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIGxvYWRGcm9tU3RvcmFnZSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RvcmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5zdG9yYWdlS2V5KTtcbiAgICAgIGlmIChzdG9yZWQpIHtcbiAgICAgICAgdGhpcy5jYXJ0ID0geyAuLi50aGlzLmNhcnQsIC4uLkpTT04ucGFyc2Uoc3RvcmVkKSB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBjYXJ0IGZyb20gc3RvcmFnZTonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3luY1dpdGhTZXJ2ZXIoKSB7XG4gICAgLy8gU3luYyBsb2NhbCBjYXJ0IHdpdGggc2VydmVyXG4gICAgaWYgKHRoaXMuY2FydC5pdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5jYXJ0Lml0ZW1zKSB7XG4gICAgICAgIGlmICghaXRlbS5zeW5jZWQpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5hZGRJdGVtKGl0ZW0ucHJvZHVjdF9pZCwgaXRlbS5xdWFudGl0eSwgaXRlbS5vcHRpb25zKTtcbiAgICAgICAgICAgIGl0ZW0uc3luY2VkID0gdHJ1ZTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gc3luYyBjYXJ0IGl0ZW06JywgZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBHZXQgbGF0ZXN0IGNhcnQgZnJvbSBzZXJ2ZXJcbiAgICBhd2FpdCB0aGlzLmdldENhcnQoKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVQZW5kaW5nRGF0YSgpIHtcbiAgICAvLyBTYXZlIGFueSBwZW5kaW5nIGNoYW5nZXMgYmVmb3JlIHBhZ2UgdW5sb2FkXG4gICAgdGhpcy5zYXZlVG9TdG9yYWdlKCk7XG4gIH1cblxuICBhc3luYyBzeW5jT2ZmbGluZURhdGEoKSB7XG4gICAgLy8gU3luYyBvZmZsaW5lIGNoYW5nZXMgd2hlbiBjb25uZWN0aW9uIGlzIHJlc3RvcmVkXG4gICAgYXdhaXQgdGhpcy5zeW5jV2l0aFNlcnZlcigpO1xuICB9XG5cbiAgdHJpZ2dlckNhcnRVcGRhdGUoKSB7XG4gICAgLy8gVHJpZ2dlciBjYXJ0IHVwZGF0ZSBldmVudFxuICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnY2FydFVwZGF0ZWQnLCB7IFxuICAgICAgZGV0YWlsOiB0aGlzLmNhcnQgXG4gICAgfSkpO1xuICB9XG5cbiAgZ2V0SXRlbUNvdW50KCkge1xuICAgIHJldHVybiB0aGlzLmNhcnQuY291bnQ7XG4gIH1cblxuICBnZXRUb3RhbCgpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJ0LnRvdGFsO1xuICB9XG5cbiAgZ2V0SXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FydC5pdGVtcztcbiAgfVxufVxuXG4vLyBOb3RpZmljYXRpb24gU2VydmljZVxuY2xhc3MgTm90aWZpY2F0aW9uU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYXBpU2VydmljZSA9IG5ldyBBcGlTZXJ2aWNlKCk7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zID0gW107XG4gICAgdGhpcy51bnJlYWRDb3VudCA9IDA7XG4gICAgdGhpcy5wb2xsSW50ZXJ2YWwgPSBudWxsO1xuICAgIHRoaXMucG9sbEZyZXF1ZW5jeSA9IDMwMDAwOyAvLyAzMCBzZWNvbmRzXG4gIH1cblxuICBhc3luYyBpbml0KCkge1xuICAgIC8vIExvYWQgaW5pdGlhbCBub3RpZmljYXRpb25zXG4gICAgYXdhaXQgdGhpcy5nZXROb3RpZmljYXRpb25zKCk7XG4gICAgXG4gICAgLy8gU3RhcnQgcG9sbGluZyBmb3IgbmV3IG5vdGlmaWNhdGlvbnMgaWYgdXNlciBpcyBhdXRoZW50aWNhdGVkXG4gICAgaWYgKHdpbmRvdy5hcHA/LmF1dGhTZXJ2aWNlPy5pc0xvZ2dlZEluKCkpIHtcbiAgICAgIHRoaXMuc3RhcnRQb2xsaW5nKCk7XG4gICAgfVxuXG4gICAgLy8gTGlzdGVuIGZvciBhdXRoIHN0YXRlIGNoYW5nZXNcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYXV0aFN0YXRlQ2hhbmdlZCcsIChldmVudCkgPT4ge1xuICAgICAgaWYgKGV2ZW50LmRldGFpbC5hdXRoZW50aWNhdGVkKSB7XG4gICAgICAgIHRoaXMuc3RhcnRQb2xsaW5nKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLnVucmVhZENvdW50ID0gMDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdldE5vdGlmaWNhdGlvbnMocGFnZSA9IDEsIGxpbWl0ID0gMjApIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UuZ2V0KGAvYXBpL25vdGlmaWNhdGlvbnM/cGFnZT0ke3BhZ2V9JmxpbWl0PSR7bGltaXR9YCk7XG4gICAgICBcbiAgICAgIGlmIChwYWdlID09PSAxKSB7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IHJlc3BvbnNlLmRhdGEubm90aWZpY2F0aW9ucyB8fCBbXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IFsuLi50aGlzLm5vdGlmaWNhdGlvbnMsIC4uLihyZXNwb25zZS5kYXRhLm5vdGlmaWNhdGlvbnMgfHwgW10pXTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy51bnJlYWRDb3VudCA9IHJlc3BvbnNlLmRhdGEudW5yZWFkX2NvdW50IHx8IDA7XG4gICAgICB0aGlzLnRyaWdnZXJOb3RpZmljYXRpb25VcGRhdGUoKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdHZXQgbm90aWZpY2F0aW9ucyBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgZGF0YTogeyBub3RpZmljYXRpb25zOiBbXSwgdW5yZWFkX2NvdW50OiAwIH0gfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBtYXJrQXNSZWFkKG5vdGlmaWNhdGlvbklkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLnBvc3QoYC9hcGkvbm90aWZpY2F0aW9ucy8ke25vdGlmaWNhdGlvbklkfS9yZWFkYCk7XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBsb2NhbCBub3RpZmljYXRpb25cbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IHRoaXMubm90aWZpY2F0aW9ucy5maW5kKG4gPT4gbi5pZCA9PT0gbm90aWZpY2F0aW9uSWQpO1xuICAgICAgaWYgKG5vdGlmaWNhdGlvbikge1xuICAgICAgICBub3RpZmljYXRpb24ucmVhZF9hdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgdGhpcy51bnJlYWRDb3VudCA9IE1hdGgubWF4KDAsIHRoaXMudW5yZWFkQ291bnQgLSAxKTtcbiAgICAgICAgdGhpcy50cmlnZ2VyTm90aWZpY2F0aW9uVXBkYXRlKCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignTWFyayBub3RpZmljYXRpb24gYXMgcmVhZCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbWFya0FsbEFzUmVhZCgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmFwaVNlcnZpY2UucG9zdCgnL2FwaS9ub3RpZmljYXRpb25zL3JlYWQtYWxsJyk7XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBsb2NhbCBub3RpZmljYXRpb25zXG4gICAgICB0aGlzLm5vdGlmaWNhdGlvbnMuZm9yRWFjaChub3RpZmljYXRpb24gPT4ge1xuICAgICAgICBpZiAoIW5vdGlmaWNhdGlvbi5yZWFkX2F0KSB7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnJlYWRfYXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICB0aGlzLnVucmVhZENvdW50ID0gMDtcbiAgICAgIHRoaXMudHJpZ2dlck5vdGlmaWNhdGlvblVwZGF0ZSgpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01hcmsgYWxsIG5vdGlmaWNhdGlvbnMgYXMgcmVhZCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZGVsZXRlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbklkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLmRlbGV0ZShgL2FwaS9ub3RpZmljYXRpb25zLyR7bm90aWZpY2F0aW9uSWR9YCk7XG4gICAgICBcbiAgICAgIC8vIFJlbW92ZSBmcm9tIGxvY2FsIG5vdGlmaWNhdGlvbnNcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5ub3RpZmljYXRpb25zLmZpbmRJbmRleChuID0+IG4uaWQgPT09IG5vdGlmaWNhdGlvbklkKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gdGhpcy5ub3RpZmljYXRpb25zW2luZGV4XTtcbiAgICAgICAgaWYgKCFub3RpZmljYXRpb24ucmVhZF9hdCkge1xuICAgICAgICAgIHRoaXMudW5yZWFkQ291bnQgPSBNYXRoLm1heCgwLCB0aGlzLnVucmVhZENvdW50IC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMudHJpZ2dlck5vdGlmaWNhdGlvblVwZGF0ZSgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0RlbGV0ZSBub3RpZmljYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbmROb3RpZmljYXRpb24odXNlcklkLCB0aXRsZSwgbWVzc2FnZSwgdHlwZSA9ICdpbmZvJywgZGF0YSA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLnBvc3QoJy9hcGkvbm90aWZpY2F0aW9ucy9zZW5kJywge1xuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgIHRpdGxlLFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICB0eXBlLFxuICAgICAgICBkYXRhXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdTZW5kIG5vdGlmaWNhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgc3RhcnRQb2xsaW5nKCkge1xuICAgIGlmICh0aGlzLnBvbGxJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnBvbGxJbnRlcnZhbCk7XG4gICAgfVxuICAgIFxuICAgIHRoaXMucG9sbEludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5nZXROb3RpZmljYXRpb25zKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ05vdGlmaWNhdGlvbiBwb2xsaW5nIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB9XG4gICAgfSwgdGhpcy5wb2xsRnJlcXVlbmN5KTtcbiAgfVxuXG4gIHN0b3BQb2xsaW5nKCkge1xuICAgIGlmICh0aGlzLnBvbGxJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnBvbGxJbnRlcnZhbCk7XG4gICAgICB0aGlzLnBvbGxJbnRlcnZhbCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3luY09mZmxpbmVEYXRhKCkge1xuICAgIC8vIFN5bmMgYW55IG9mZmxpbmUgbm90aWZpY2F0aW9uIGFjdGlvbnMgd2hlbiBjb25uZWN0aW9uIGlzIHJlc3RvcmVkXG4gICAgYXdhaXQgdGhpcy5nZXROb3RpZmljYXRpb25zKCk7XG4gIH1cblxuICB0cmlnZ2VyTm90aWZpY2F0aW9uVXBkYXRlKCkge1xuICAgIC8vIFRyaWdnZXIgbm90aWZpY2F0aW9uIHVwZGF0ZSBldmVudFxuICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnbm90aWZpY2F0aW9uc1VwZGF0ZWQnLCB7IFxuICAgICAgZGV0YWlsOiB7IFxuICAgICAgICBub3RpZmljYXRpb25zOiB0aGlzLm5vdGlmaWNhdGlvbnMsIFxuICAgICAgICB1bnJlYWRDb3VudDogdGhpcy51bnJlYWRDb3VudCBcbiAgICAgIH0gXG4gICAgfSkpO1xuICB9XG5cbiAgZ2V0Tm90aWZpY2F0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zO1xuICB9XG5cbiAgZ2V0VW5yZWFkQ291bnQoKSB7XG4gICAgcmV0dXJuIHRoaXMudW5yZWFkQ291bnQ7XG4gIH1cblxuICAvLyBCcm93c2VyIG5vdGlmaWNhdGlvbiBzdXBwb3J0XG4gIGFzeW5jIHJlcXVlc3RQZXJtaXNzaW9uKCkge1xuICAgIGlmICgnTm90aWZpY2F0aW9uJyBpbiB3aW5kb3cpIHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24oKTtcbiAgICAgIHJldHVybiBwZXJtaXNzaW9uID09PSAnZ3JhbnRlZCc7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHNob3dCcm93c2VyTm90aWZpY2F0aW9uKHRpdGxlLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoJ05vdGlmaWNhdGlvbicgaW4gd2luZG93ICYmIE5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uID09PSAnZ3JhbnRlZCcpIHtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24odGl0bGUsIHtcbiAgICAgICAgaWNvbjogJy9zdGF0aWMvYXNzZXRzL2ltYWdlcy9pY29uLTE5MngxOTIucG5nJyxcbiAgICAgICAgYmFkZ2U6ICcvc3RhdGljL2Fzc2V0cy9pbWFnZXMvaWNvbi03Mng3Mi5wbmcnLFxuICAgICAgICAuLi5vcHRpb25zXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQXV0byBjbG9zZSBhZnRlciA1IHNlY29uZHNcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gbm90aWZpY2F0aW9uLmNsb3NlKCksIDUwMDApO1xuICAgICAgXG4gICAgICByZXR1cm4gbm90aWZpY2F0aW9uO1xuICAgIH1cbiAgfVxufVxuXG4vLyBJbml0aWFsaXplIHNlcnZpY2VzIHdoZW4gRE9NIGlzIGxvYWRlZFxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgLy8gTWFrZSBzZXJ2aWNlcyBnbG9iYWxseSBhdmFpbGFibGVcbiAgd2luZG93LmFwcCA9IHdpbmRvdy5hcHAgfHwge307XG4gIHdpbmRvdy5hcHAuYXBpU2VydmljZSA9IG5ldyBBcGlTZXJ2aWNlKCk7XG4gIHdpbmRvdy5hcHAuYXV0aFNlcnZpY2UgPSBuZXcgQXV0aFNlcnZpY2UoKTtcbiAgd2luZG93LmFwcC5jYXJ0U2VydmljZSA9IG5ldyBDYXJ0U2VydmljZSgpO1xuICB3aW5kb3cuYXBwLm5vdGlmaWNhdGlvblNlcnZpY2UgPSBuZXcgTm90aWZpY2F0aW9uU2VydmljZSgpO1xufSk7XG5cbi8vIEV4cG9ydCBmb3IgbW9kdWxlIHN5c3RlbXNcbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBBcGlTZXJ2aWNlLFxuICAgIEF1dGhTZXJ2aWNlLFxuICAgIENhcnRTZXJ2aWNlLFxuICAgIE5vdGlmaWNhdGlvblNlcnZpY2VcbiAgfTtcbn0iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///889\n\n}");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ var __webpack_exec__ = function(moduleId) { return __webpack_require__(__webpack_require__.s = moduleId); }
/******/ var __webpack_exports__ = (__webpack_exec__(889));
/******/ }
]);